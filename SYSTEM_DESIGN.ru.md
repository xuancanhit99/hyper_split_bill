# ‚öôÔ∏è –î–∏–∑–∞–π–Ω –°–∏—Å—Ç–µ–º—ã: Hyper Split Bill

## 1. üìù –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∏–∑–∞–π–Ω —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Hyper Split Bill. –¶–µ–ª—å —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –æ–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—á–µ—Ç–æ–≤.

## 2. üéØ –¶–µ–ª–∏

*   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—â–∏–º–∏ —Å—á–µ—Ç–∞–º–∏.
*   –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —Å—á–µ—Ç–∞ (–ø–æ–∑–∏—Ü–∏–∏, —Ü–µ–Ω—ã) –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é OCR.
*   –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ò–ò/LLM.
*   –ü–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ª–µ–≥–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ/—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
*   –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π —Å—á–µ—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.
*   –¢–æ—á–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é –¥–æ–ª–∂–µ–Ω –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫.
*   –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏—Ö —Å—á–µ—Ç–æ–≤.
*   –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º (Web, iOS, Android) —Å –ø–æ–º–æ—â—å—é Flutter.

## 3. ‚ùå –ù–µ-—Ü–µ–ª–∏

*   –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —à–ª—é–∑–∞–º–∏.
*   –°–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –≤—ã—Ö–æ–¥—è—â–∏–µ –∑–∞ —Ä–∞–º–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—á–µ—Ç–æ–≤.
*   –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –∑–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è –∏–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏ –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ–¥–Ω–æ–≥–æ —Å—á–µ—Ç–∞.
*   –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Offline-first (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ OCR, –ò–ò –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Supabase).

## 4. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 4.1. –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –æ–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Å–ª–µ–¥—É–µ—Ç –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, –≥–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Flutter (–∫–ª–∏–µ–Ω—Ç) –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å–∞–º–∏ (Supabase) –∏ –≤–Ω–µ—à–Ω–∏–º–∏ API (OCR, –ò–ò).

```mermaid
graph LR
    A[–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Flutter] -- Auth/DB Ops --> B(Supabase);
    A -- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è --> C(OCR API);
    C -- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ --> A;
    A -- –¢–µ–∫—Å—Ç/–ö–æ–Ω—Ç–µ–∫—Å—Ç --> D(AI/LLM API);
    D -- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ --> A;
```

**–ü–æ—Ç–æ–∫:**

1.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç–∞.
2.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ –≤–Ω–µ—à–Ω–∏–π OCR API.
3.  OCR API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
4.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (–∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –≤ AI/LLM API –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.
5.  AI API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–∑–∏—Ü–∏–∏, —Ü–µ–Ω—ã).
6.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
7.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Å—á–µ—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Supabase —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

### 4.2. –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Clean Architecture + Bloc

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Flutter –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Clean Architecture –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å Bloc –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

```mermaid
graph TD
    subgraph Presentation Layer
        P1[Pages/Widgets]
        P2[Bloc/Cubit]
    end
    subgraph Domain Layer
        D1[Use Cases]
        D2[Entities]
        D3[Repository Interfaces]
    end
    subgraph Data Layer
        DA1[Repository Implementations]
        DA2[Data Sources]
        DA3[Models]
    end

    P1 --> P2;
    P2 --> D1;
    D1 --> D3;
    D1 --> D2;
    DA1 --> D3;
    DA1 --> DA2;
    DA2 --> DA3;

    subgraph External
        E1[Supabase]
        E2[OCR API]
        E3[AI/LLM API]
        E4[Device Storage/Camera]
    end

    DA2 -- Interacts with --> E1;
    DA2 -- Interacts with --> E2;
    DA2 -- Interacts with --> E3;
    DA2 -- Interacts with --> E4;

    style Presentation Layer fill:#f9f,stroke:#333,stroke-width:2px
    style Domain Layer fill:#ccf,stroke:#333,stroke-width:2px
    style Data Layer fill:#9cf,stroke:#333,stroke-width:2px
```

*   **Presentation Layer:** –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ UI (`–°—Ç—Ä–∞–Ω–∏—Ü—ã`, `–í–∏–¥–∂–µ—Ç—ã`) –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (`Bloc`). –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–∑—ã–≤–∞—é—Ç —Å–æ–±—ã—Ç–∏—è –≤ Blocs. Blocs –≤—ã–∑—ã–≤–∞—é—Ç Use Cases –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `go_router` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
*   **Domain Layer:** –°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É. `Use Cases` —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ—Ç–æ–∫–æ–º –¥–∞–Ω–Ω—ã—Ö, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—è —Å `–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤`. `–°—É—â–Ω–æ—Å—Ç–∏` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç—ã. –≠—Ç–æ—Ç —Å–ª–æ–π –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Flutter –∏ –≤–Ω–µ—à–Ω–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤.
*   **Data Layer:** –†–µ–∞–ª–∏–∑—É–µ—Ç `–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ –¥–æ–º–µ–Ω–Ω–æ–º —Å–ª–æ–µ. `–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏` –∏–∑–≤–ª–µ–∫–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö `–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –î–∞–Ω–Ω—ã—Ö` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `AuthRemoteDataSource`, `BillRemoteDataSource`, `OcrDataSource`, `ChatDataSource`). `–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –î–∞–Ω–Ω—ã—Ö` –Ω–∞–ø—Ä—è–º—É—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (Supabase, API) –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º. `–ú–æ–¥–µ–ª–∏` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON).

### 4.3. –†–∞–∑–±–∏–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

*   **Core:** –ë–∞–∑–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (`go_router`), –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`get_it`, `injectable`), —Ç–µ–º–∞, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
*   **Features:** –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –º–æ–¥—É–ª–∏:
    *   **Auth:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `AuthBloc`, `AuthRepository`, `AuthRemoteDataSource` (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—è —Å Supabase Auth).
    *   **Bill Splitting:** –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –≤–∫–ª—é—á–∞—é—â–∞—è:
        *   `BillUploadPage`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä/–æ–±—Ä–µ–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        *   `ImageCropPage`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç UI –æ–±—Ä–µ–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
        *   `BillEditPage`: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏, —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –≤–∞–ª—é—Ç—É –∏ —Ç.–¥. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã (`BillItemsSection`, `BillParticipantsSection`).
        *   `ChatbotPage`: (–í–æ–∑–º–æ–∂–Ω–æ) –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–µ—Ä–≤–∏—Å–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ò–ò.
        *   `BillSplittingBloc`: –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—á–µ—Ç–∞ (–∑–∞–≥—Ä—É–∑–∫–∞, OCR, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ).
        *   `ProcessBillOcrUseCase`, `CreateBillUseCase`, `GetBillsUseCase`, `SendChatMessageUseCase`: –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
        *   `BillRepository`: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥–∞–Ω–Ω—ã–º–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å–æ —Å—á–µ—Ç–∞–º–∏.
        *   `BillRepositoryImpl`: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∞—è `BillRemoteDataSource`, `OcrDataSource`, `ChatDataSource`.
        *   `OcrDataSource`: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å/–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å OCR API.
        *   `ChatDataSource`: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å/–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å AI/LLM API.
        *   `BillRemoteDataSource`: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å/–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Supabase (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—á–µ—Ç–æ–≤).

## 5. ‚û°Ô∏è –ü—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—á–µ—Ç–∞

1.  **–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –≥–∞–ª–µ—Ä–µ–∏" –Ω–∞ `BillUploadPage`.
2.  **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:**
    *   –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `_pickImageFromGallery`. `image_picker` –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`XFile`).
    *   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–µ–∑–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `ImageCropPage` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è `image_cropper`).
    *   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É. `BillUploadPage` –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ProcessBill` –≤ `BillSplittingBloc`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª/–±–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
3.  **Bloc:**
    *   `BillSplittingBloc` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ProcessBill`.
    *   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `BillSplittingOcrProcessing` (UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏).
    *   –í—ã–∑—ã–≤–∞–µ—Ç `ProcessBillOcrUseCase`.
4.  **–î–æ–º–µ–Ω:**
    *   `ProcessBillOcrUseCase` –≤—ã–∑—ã–≤–∞–µ—Ç `processBillImage` –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `BillRepository`.
5.  **–î–∞–Ω–Ω—ã–µ:**
    *   `BillRepositoryImpl.processBillImage` –≤—ã–∑—ã–≤–∞–µ—Ç `processImage` –≤ `OcrDataSource`.
    *   `OcrDataSourceImpl` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ –≤–Ω–µ—à–Ω–∏–π OCR API.
    *   OCR API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
    *   (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ò–ò):
        *   `BillRepositoryImpl` –º–æ–∂–µ—Ç –∑–∞—Ç–µ–º –≤—ã–∑–≤–∞—Ç—å `structureData` –≤ `ChatDataSource` (–ø–µ—Ä–µ–¥–∞–≤–∞—è —Ç–µ–∫—Å—Ç OCR).
        *   `ChatDataSourceImpl` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ AI/LLM API.
        *   AI API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ `BillEntity`.
    *   `BillRepositoryImpl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `BillEntity` (–∏–ª–∏ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç OCR, –µ—Å–ª–∏ —à–∞–≥ –ò–ò –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç).
6.  **–î–æ–º–µ–Ω:** `ProcessBillOcrUseCase` –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
7.  **Bloc:**
    *   `BillSplittingBloc` –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `BillEntity` (–∏–ª–∏ —Ç–µ–∫—Å—Ç).
    *   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `BillSplittingSuccess` (–∏–ª–∏ `BillSplittingNeedsStructuring`, –µ—Å–ª–∏ –±—ã–ª –≤–æ–∑–≤—Ä–∞—â–µ–Ω —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç) —Å –¥–∞–Ω–Ω—ã–º–∏.
    *   –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `BillEditPage` —á–µ—Ä–µ–∑ `go_router`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
8.  **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:** `BillEditPage` —Å—Ç—Ä–æ–∏—Ç —Å–≤–æ–π UI –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –æ—Ç `BillSplittingBloc`, –æ—Ç–æ–±—Ä–∞–∂–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.

## 6. üåê –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

*   **Supabase:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Supabase Auth) –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (Supabase Postgres) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—á–µ—Ç–æ–≤. –î–æ—Å—Ç—É–ø –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç `supabase_flutter`.
*   **OCR API:** –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—á–µ—Ç–æ–≤ –≤ —Ç–µ–∫—Å—Ç. –¢—Ä–µ–±—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏ API. (–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å TBD).
*   **AI/LLM API:** –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, OpenAI, Gemini –∏ —Ç.–¥.), –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ–¥–æ–±–Ω—ã–π —á–∞—Ç—É (`ChatDataSource`), –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ OCR –≤ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å—á–µ—Ç–∞ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –¢—Ä–µ–±—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏ API. (–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å TBD).

## 7. üíæ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è - Supabase)

*   **users:** (–£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Supabase Auth) –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   **bills:**
    *   `id` (uuid, PK)
    *   `user_id` (uuid, FK –∫ auth.users)
    *   `title` (text)
    *   `bill_date` (date/timestamp)
    *   `currency` (text)
    *   `total_amount` (numeric) - –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è
    *   `created_at` (timestamp)
    *   `image_url` (text, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
*   **participants:**
    *   `id` (uuid, PK)
    *   `bill_id` (uuid, FK –∫ bills)
    *   `name` (text)
    *   `user_id` (uuid, FK –∫ auth.users, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –µ—Å–ª–∏ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
*   **bill_items:**
    *   `id` (uuid, PK)
    *   `bill_id` (uuid, FK –∫ bills)
    *   `description` (text)
    *   `quantity` (integer, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
    *   `price` (numeric)
*   **item_assignments:** (–°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É –ø–æ–∑–∏—Ü–∏—è–º–∏ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏)
    *   `item_id` (uuid, FK –∫ bill_items)
    *   `participant_id` (uuid, FK –∫ participants)
    *   `share_amount` (numeric) - –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –¥–æ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

*(–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞. –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.)*

## 8. üìú –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã API (–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ)

*   **–ó–∞–ø—Ä–æ—Å OCR API:** `POST /ocr` —Å `image_data` (base64 –∏–ª–∏ multipart/form-data).
*   **–û—Ç–≤–µ—Ç OCR API:** `{ "text": "–∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç..." }`
*   **–ó–∞–ø—Ä–æ—Å AI/LLM API:** `POST /structure_bill` —Å `{ "ocr_text": "...", "context": "..." }`
*   **–û—Ç–≤–µ—Ç AI/LLM API:** `{ "bill": { "title": "...", "items": [...], "participants": [...] } }`

## 9. ‚ö° –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

*   –î–≤–∏–∂–æ–∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ Flutter –≤ —Ü–µ–ª–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–Ω.
*   –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å –ø–æ–º–æ—â—å—é Bloc –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö UI.
*   –í—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö API (OCR, –ò–ò) —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ —É–∑–∫–∏–º–∏ –º–µ—Å—Ç–∞–º–∏; –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏.
*   Supabase –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –±—ç–∫–µ–Ω–¥-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.
*   –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∑–∞–≥—Ä—É–∑–∫–∞, –≤–æ–∑–º–æ–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞) –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

## 10. üîí –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

*   –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö Supabase –∏ –∫–ª—é—á–µ–π API (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `.env` –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞).
*   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Supabase Auth.
*   –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–æ–ª—è—Ö.
*   –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ (RLS) –≤ Supabase –∏–º–µ–µ—Ç —Ä–µ—à–∞—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º —Å—á–µ—Ç–∞–º.
*   HTTPS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π API.